<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Description" content="Documentation for Ethel">
    <title>Ethel Docs</title>
    <base href="/ethel/">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  </head>
  <body class="app">
    <section class="header">
      <div class="name">
        <a href="">Ethel Docs</a>
      </div>
    </section>
    <aside class="panel menu">
      <div class="docs-menu">
        
          <p class="menu-label">Basics</p>
          <ul class="menu-list">
              <li>
                <a href="">Overview</a>
                
              </li>
              <li>
                <a href="pages/basic/jobs/">Jobs and runs</a>
                
              </li>
              <li>
                <a href="pages/basic/notifications/">Notifications</a>
                
              </li>
              <li>
                <a href="pages/basic/client/">Client</a>
                
              </li>
              <li>
                <a href="pages/basic/deployment/">Deployment</a>
                
              </li>
              <li>
                <a href="pages/basic/core-config/">Core configuration</a>
                
              </li>
          </ul>
          <p class="menu-label">Runner config</p>
          <ul class="menu-list">
              <li>
                <a href="pages/runner-config/runners/">Runner types</a>
                
              </li>
              <li>
                <a href="pages/runner-config/common-options/">Common options</a>
                
              </li>
              <li>
                <a href="pages/runner-config/mock/">Mock runners</a>
                
              </li>
              <li>
                <a href="pages/runner-config/text-files/">Text files</a>
                
              </li>
              <li>
                <a href="pages/runner-config/file-system/">File system</a>
                
              </li>
              <li>
                <a href="pages/runner-config/databases/">Databases</a>
                
              </li>
              <li>
                <a href="pages/runner-config/email/">Email</a>
                
              </li>
              <li>
                <a href="pages/runner-config/ot/">OpenText runners</a>
                
                  <ul>
                      <li>
                        <a href="pages/runner-config/archive-center/">Archive Server</a>
                      </li>
                      <li>
                        <a href="pages/runner-config/content-server/">Content Server</a>
                      </li>
                      <li>
                        <a href="pages/runner-config/success-factors/">Success Factors</a>
                      </li>
                  </ul>
                
              </li>
              <li>
                <a href="pages/runner-config/microsoft/">Microsoft runners</a>
                
                  <ul>
                      <li>
                        <a href="pages/runner-config/sharepoint/">SharePoint</a>
                      </li>
                  </ul>
                
              </li>
          </ul>
          <p class="menu-label">Development</p>
          <ul class="menu-list">
              <li>
                <a href="pages/development/design/">Design</a>
                
              </li>
              <li>
                <a href="pages/development/repository/">Repository</a>
                
              </li>
              <li>
                <a href="pages/development/server/">Server</a>
                
              </li>
              <li>
                <a href="pages/development/runners/">Runners</a>
                
              </li>
          </ul>
      </div>
    </aside>
    <section class="panel">
      <div class="section">
        <div class="container is-fluid">
          
<h3 class="title is-3">Common options</h3>
<div class="content">

  <p>This page details a number of common configuration options that are available within many or all runners.</p>
  <ul>
    <li><a href="pages/runner-config/common-options/#filters">Filters</a></li>
    <li><a href="pages/runner-config/common-options/#errors">Error handling and retry</a></li>
    <li><a href="pages/runner-config/common-options/#batches">Batches</a></li>
    <li><a href="pages/runner-config/common-options/#repeat">Repeating jobs</a></li>
    <li><a href="pages/runner-config/common-options/#text-replacement">Text replacement</a></li>
    <li><a href="pages/runner-config/common-options/#queues">Queues</a></li>
  </ul>

  <section class="filters">

    <h4 id="filters" class="title is-4 docs-subhead">Ignoring extract items</h4>

    <p>All extractors have the filters configuration option to control which extract items are ignored or included.
      Filters tell the extractor which items should not be raised as a task and use a syntax based on the URL
      search paramters. The paramter name is the attribute in the task message containing the value used in the filter
      and the paramter value holds the filter arguments.
    </p>

    <h5>Filter arguments</h5>
    <p>Filter arguments are made up of up to three components:</p>
    <ul>
      <li>case sensitive - whether the test is case sensitive or not, defaults to true</li>
      <li>comparison operator - what test is used, defaults to equal. Support operators are:</li>
      <ul>
        <li>in - includes</li>
        <li>ni - not includes</li>
        <li>eq - equals</li>
        <li>ne - not equals</li>
        <li>gt - greater than</li>
        <li>ge - greater than or equal to</li>
        <li>lt - less than</li>
        <li>le - less than or equal to</li>
        <li>sw - starts with</li>
        <li>!sw - not starts with</li>
        <li>ew - ends with</li>
        <li>!ew - not ends with</li>
        <li>re - regular expresion - not implemented yet</li>
      </ul>
      <li>test value - mandatory, the value to be tested against</li>
    </ul>

    <h5>Filter joins</h5>
    <p>By default multiple filter parameters are evaluated as <code>or</code> combinations. To evaluate as an
      <code>and</code>combination use <code>&join=and&</code> to join the filters.
    </p>

    <h5>Examples</h5>
    <p><code>extractItem.name=in|.txt</code><br>
      Exclude all items that include <code>.txt</code> in the name field</p>

    <p><code>extractItem.name=false|!ew|.pdf</code><br>
      Exclude items where the name field does not end with .pdf, case insensitive</p>

    <p><code>extractItem.name=ew|.txt&join=and&extractItem.path=in|DRAFTS</code><br>
      Exclude all items that end with .txt in the name field and have DRAFTS in the path</p>

    <p><code>extractItem.name=ew|[".txt",".pdf"]</code><br>
      Exclude all items where the name ends in .txt or .pdf</p>

    <p><code>extractItem.stats.size=lt|100</code><br>
      Exclude all files with a size less than 100 bytes</p>

  </section>

  <section class="errors">

    <h4 id="errors" class="title is-4 docs-subhead">Error handling and retry</h4>

    <p>By default, when a runner hits an error it records the error message and stops processing the task, setting it's
      status to suspended. You can then manually restart the task via the client or API.</p>
    <p>By adding a retry policy the runner can automatically retry the task. Retries can be configured to control the
      number of retries, the delay between the retries and what error messages would not be retried. This configuration
      option is available for all runners.</p>
    <p>This simplest retry policy is to set a number of retry attempts. There will be a five second delay between each
      retry by default. Example of this with two retry attempts:</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {...},
  "retry": {
    "limit": 2
  }
}</pre>
    <p>You can also specify a different amount of delay, as well as the ability to increase the delay between each
      retry.
      The delay is specified in milliseconds and the backoff option multiplies the delay by the number of retries.</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {...},
  "retry": {
    "limit": 2,
    "delay": 10000,
    "pattern": "backoff"
  }
}</pre>
    <p>In addition to changing the number of retries and the delay between retries you can also specify error messages
      that will not be retried and can either be suspended or quarantined. A task with an error message matching a
      quarantined message is stopped and a quarantine lookup is created. An item with a quarantine lookup will not be
      processed again until the quarantine is removed by deleting the lookup. Suspended errors can be retried by
      restarting the task via the client or API.</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {...},
  "retry": {
    "limit": 2,
    "delay": 10000,
    "pattern": "backoff",
    "suspendMessages": [
      "System is unavailable"
    ], 
    "quarantineMessages": [
      "Item already exists"
    ]
  }
}</pre>

    <p>The quarantine functionality allows you to stop a particular item in the migration from being processed. This
      would
      be used when there's a problem that needs to be resolved before another attempt is made to process the item.</p>
    <p>Quarantining a task creates a lookup using the extractId created by the extract runner and the quarantine
      name specified in the extractor configuration. Once quarantined, the item will not be extracted again until the
      quarantine lookup is deleted.</p>
    <p>Items can be quarantined via the client, via an error retry configuration or via the API. To quarantine an item
      in
      the client find the task that has the issue and click the Quarantine button.</p>
    <p>Example extract configuration is:</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {
    "quarantinedLookupName": "HRMigrationQuarantined",
  }
}</pre>

    <p>To quarantine an item based on error message use the retry object in the runner config:</p>
    <pre class="code">{
  "type": "OTCSLoader",
  "config": {...},
  "retry": {
    "limit": 2,
    "quarantineMessages": [
      "Item already exists"
    ]
  }
}</pre>

  </section>

  <section class="batches">

    <h4 id="batches" class="title is-4 docs-subhead">Batches</h4>

    <p>All extractors provide the option to split a large job into multiple runs. To set up batches specify the batch
      size and whether the next run is automatically queued:</p>
    <ul>
      <li><code>size</code> <strong>mandatory</strong> number - how many tasks generated in the batch</li>
      <li><code>queueNextRun</code> boolean - whether the next run is automatically generated. Defaults to false</li>
    </ul>

    <p>Example config is:</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {
    "hashName": "HRMigration",
    "batchConfig": {
      "size": 5000,
      "queueNextRun": true
    },
  }
}</pre>

    <p class="title is-5 docs-subhead">Database batch skipping</p>

    <p>When using batch config the runner will automatically skip records that were processed in previous batches. For
      database extractors this may not be required as the tracking of what has been extracted can be handled by the
      database. In this scenario set the <code>disableSkip</code> config option to true and batch skipping will be
      disabled.</p>

  </section>

  <section class="repeat">

    <h4 id="repeat" class="title is-4 docs-subhead">Repeating runs</h4>

    <p>Most extract runners provide the ability to repeat the extract and ignore unchanged data. To allow this to happen
      the configuration section requires a hashName. The hashName will be used to store a value as a lookup that is used
      to compare the data on later runs to see if it has changed.</p>
    <p>The lookup is made up of:</p>
    <ul>
      <li>name - the hashName supplied in the runner config</li>
      <li>key - a unique identifier to the piece of data</li>
      <li>value - the value used to compare if the item has changed between runs</li>
    </ul>
    <p>Each runner will generate the value used for the comparison based on the data structures of the extract system.
      For
      example the FileSystemExtractor generates uses these values:</p>
    <ul>
      <li>name - the hashName supplied in the runner config</li>
      <li>key - a hash of the path to the file or directory</li>
      <li>value - a hash of an object with at least the following information:
        <ul>
          <li>size - the file size in bytes</li>
          <li>mtimeMs - the time the file was last modified</li>
          <li>birthtimeMs - the time the file was created</li>
        </ul>
      </li>
    </ul>

    <p>To support the ability to ignore unchanged items in multiple runs add the following to the runner config:</p>
    <pre class="code">{
  "type": "PSTLoader",
  "config": {
      ...
    "hashName": "HRMigration",
  ...
  }
}</pre>

    <p>This would create an extract hash object in the message like:</p>
    <pre class="code">{
  "message": {
      ...
    "extractHash": {
      "name": "HRMigration",
      "key": "ef15711093fce44857f960c27f239414ee7beaaa",
      "value": {
        "source": "C:\\code\\test\\fs-extract\\built-file3.txt",
        "hash": "78e983c58916366b6534c63b96d28cfccf00aaf9",
      },
    },
    ...
}</pre>

    <p>As these values are lookups they can be reset by using the Lookups section in the client. Find the lookups with
      the name specified and delete these lookups to reset the check.</p>

    <h5 class="title is-5 docs-subhead">Disable extract hash checking</h5>

    <p>By default, an extractor checks each item being extracted to see if it has already been extracted. It does this
      by
      checking to see if there is a lookup with the extractHash name and the extractId of the item being extracted. If
      there is a lookup for each loader in the run, no task is raised for the item.
    </p>
    <p>In some jobs a transformer may raise multiple tasks per extractId. In this scenario the extractor is unable to
      determine if all the tasks were raised in a previous task. The <code>isProcessed</code> check by the extractor
      should be cancelled and the transformer should determine if all tasks have been raised. To do this set
      <code>checkProcessed</code> to false in the extractor config object
    </p>
    <pre class="code">{
  "type": "SQLLiteExtractor",
  "config": {
    "hashName": "HRMigration",
    "batchConfig": {
      "checkProcessed": false,
      "size": 50000,
      "queueNextRun": true
    },
  }
}</pre>

  </section>

  <section class="text-replacement">

    <h4 id="text-replacement" class="title is-4 docs-subhead">Text replacement</h4>

    <p>Strings can be processed by the parseTemplateString function from the task-runner base class.
      This function will find all occurences of <code>${.*}</code> in the supplied text string.</p>
    <p>For each occurrence it will assume the value is in the message attribute of the task and will split the value by
      periods. It will then iterate through the segments to check if that attribute exists in the message object.</p>
    <p>For example the query <code>UPDATE status SET updated = '${MockLoaderCompleted}' WHERE id = '${item.id}'</code>
      will look for <code>this.task.message.MockLoaderCompleted</code> and <code>this.task.message.item.id</code> and
      replace these with the values of the attributes.</p>

  </section>

  <section class="queues">

    <h4 id="queues" class="title is-4 docs-subhead">Queues</h4>

    <p>By default all tasks are sent to a message queue called <strong>Tasks</strong> and all instances create a
      <strong>Tasks</strong> consumer. In some situations you may want a runner to use an alternative queue or configure
      an instance to consume queues other than <strong>Tasks</strong>.
    </p>
    <p>An example is a queue for tasks processed after working hours. In this case you create a queue, say
      <i>AfterHours</i>. Consumers of this queue can then be configured to only process tasks after working hours. To
      send tasks for a particular runner to the other queue, update the queue attribute of the runner
    </p>
    <pre class="code">"runners":{
    ...
  "load": [
    {
      "type": "OTCSLoader",
      "config": {
        ...
      },
      "queue": "AfterHours"
    }
  ]
}</pre>
    <p>Then using the client or API create a consumer with the operating hours defined. In the example below tasks using
      the AterHours queue will only run after 6pm and before 8am Monday to Friday.</p>
    <pre class="code">[
  ...,
  {
    "name": "AfterHours",
    "configCheck": 60000,
    "isConsumer": true,
    "limit": 1000,
    "operatingHours": [
      {
        "running": false,
        "prefetch": 4,
        "cron": "0 8 * * 1-5"
      },
      {
        "running": true,
        "prefetch": 4,
        "cron": "0 18 * * 1-5"
      }
    ],
    "prefetch": 4,
    "reconnect": {
      "attempts": 0,
      "enabled": false,
      "maxAttempts": 5,
      "wait": 1000,
      "backoff": 2
    },
    "type": "BetterQueue"
  }
]</pre>

  </section>

</div>
        </div>
        <div class="container is-fluid dl-footer">
          <a href="https://driverlane.com.au">Driver Lane</a>
          &copy; 2020-2025
        </div>
      </div>
    </div>
  </body>
</html>